<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ä»“åº“è´§æ¶å¸ƒå±€æ¼”ç¤º</title>
  <!-- å¼•å…¥Vue2 -->
  <script src="https://cdn.bootcdn.net/ajax/libs/vue/2.6.14/vue.min.js"></script>
  <!-- å¼•å…¥Element UI -->
  <script src="https://cdn.bootcdn.net/ajax/libs/element-ui/2.15.13/index.min.js"></script>
  <!-- å¼•å…¥Element UIä¸­æ–‡è¯­è¨€åŒ… -->
  <script src="https://cdn.bootcdn.net/ajax/libs/element-ui/2.15.13/locale/zh-CN.min.js"></script>
  <!-- å¼•å…¥Element UI CSS -->
  <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/element-ui/2.15.13/theme-chalk/index.css">
  <style>
    .product-modal-content {
      height: 500px;
      display: flex;
      flex-direction: column;
    }

    .product-modal-content .product-modal-content-body {
      flex: 1;
      overflow-y: auto;
    }

    .product-modal-content .product-modal-content-body-item {
      height: 60px;
      display: flex;
      justify-content: center;
      align-items: center;
    }



    .inventory-details-modal-content {
      height: 500px;
      display: flex;
      flex-direction: column;

    }

    .inventory-details-modal-content .inventory-details-modal-content-body {
      flex: 1;
      overflow-y: auto;
    }

    .inventory-details-modal-content .inventory-details-modal-content-body-item {
      height: 60px;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f5f5f5;
    }

    .warehouse-container {
      position: relative;
      background-color: #fff;
      border: 2px solid #333;
      margin: 0 auto;
      background-image: linear-gradient(#eee 1px, transparent 1px),
        linear-gradient(90deg, #eee 1px, transparent 1px);
      background-size: 20px 20px;
      min-width: 400px;
      min-height: 300px;
      max-width: 1200px;
      max-height: 800px;
    }

    .warehouse-container.design-mode {
      resize: both;
      /* å…è®¸åœ¨è®¾è®¡æ¨¡å¼ä¸‹è°ƒæ•´å¤§å° */
    }

    .resize-edge {
      position: absolute;
      background-color: transparent;
      z-index: 10;
    }

    .resize-edge.right {
      top: 0;
      right: 0;
      width: 8px;
      height: 100%;
      cursor: e-resize;
    }

    .resize-edge.bottom {
      bottom: 0;
      left: 0;
      width: 100%;
      height: 8px;
      cursor: s-resize;
    }

    .resize-edge.corner {
      right: 0;
      bottom: 0;
      width: 15px;
      height: 15px;
      cursor: se-resize;
    }

    .resize-indicator {
      position: absolute;
      right: 5px;
      bottom: 5px;
      width: 20px;
      height: 20px;
      color: #666;
      font-size: 18px;
      pointer-events: none;
      /* ç¡®ä¿ä¸å¹²æ‰°resizeæ“ä½œ */
      display: none;
    }

    .warehouse-container.design-mode:hover .resize-indicator {
      display: block;
    }

    .shelf {
      position: absolute;
      background-color: #ffd699;
      border: 2px solid #ff9900;
      border-radius: 4px;
      cursor: move;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      z-index: 1;
      user-select: none;
      min-width: 60px;
      min-height: 60px;
      margin-bottom: 40px;
      /* æ·»åŠ åº•éƒ¨è¾¹è·ï¼Œä¸ºæ“ä½œæŒ‰é’®ç•™å‡ºç©ºé—´ */
    }

    .shelf.view-mode {
      cursor: default;
    }

    .shelf-header {
      background-color: #ff9900;
      color: white;
      padding: 4px;
      font-size: 12px;
      text-align: center;
      cursor: move;
    }

    .shelf-body {
      flex-grow: 1;
      display: flex;
      justify-content: center;
      align-items: center;
      font-weight: bold;
    }

    .resize-handle {
      position: absolute;
      width: 10px;
      height: 10px;
      background-color: #666;
      border-radius: 50%;
      z-index: 2;
    }

    .resize-handle.nw {
      top: -5px;
      left: -5px;
      cursor: nw-resize;
    }

    .resize-handle.ne {
      top: -5px;
      right: -5px;
      cursor: ne-resize;
    }

    .resize-handle.sw {
      bottom: -5px;
      left: -5px;
      cursor: sw-resize;
    }

    .resize-handle.se {
      bottom: -5px;
      right: -5px;
      cursor: se-resize;
    }

    .ghost {
      opacity: 0.5;
      background-color: #c8ebfb !important;
      border: 2px dashed #4a9ed1 !important;
    }

    .controls {
      margin: 20px auto;
      max-width: 800px;
      display: flex;
      justify-content: space-between;
    }

    .mode-switch {
      margin: 20px auto 10px;
      max-width: 800px;
      display: flex;
      justify-content: flex-end;
      align-items: center;
    }

    .mode-button {
      padding: 8px 15px;
      border: none;
      color: white;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      display: flex;
      align-items: center;
    }

    .mode-button.design {
      background-color: #4CAF50;
    }

    .mode-button.design:hover {
      background-color: #45a049;
    }

    .mode-button.view {
      background-color: #2196F3;
    }

    .mode-button.view:hover {
      background-color: #0b7dda;
    }

    .mode-icon {
      margin-right: 5px;
      font-size: 16px;
    }

    .mode-status {
      display: inline-block;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin-left: 8px;
    }

    .mode-status.design {
      background-color: #4CAF50;
    }

    .mode-status.view {
      background-color: #2196F3;
    }

    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 60px;
      height: 30px;
    }

    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .toggle-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      transition: .4s;
      border-radius: 30px;
    }

    .toggle-slider:before {
      position: absolute;
      content: "";
      height: 22px;
      width: 22px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }

    input:checked+.toggle-slider {
      background-color: #4CAF50;
    }

    input:checked+.toggle-slider:before {
      transform: translateX(30px);
    }

    .save-button {
      margin-left: 10px;
      padding: 8px 15px;
      background-color: #4CAF50;
      border: none;
      color: white;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }

    .save-button:hover {
      background-color: #45a049;
    }

    .save-button:disabled {
      background-color: #cccccc;
      color: #888888;
      cursor: not-allowed;
    }

    .info-panel {
      max-width: 800px;
      margin: 20px auto;
      background-color: white;
      padding: 15px;
      border-radius: 4px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .shelf-info {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
      padding-bottom: 8px;
      border-bottom: 1px solid #eee;
    }

    .shelf-controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 10px auto;
      max-width: 800px;
      background-color: #f0f0f0;
      padding: 10px 20px;
      border-radius: 4px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .shelf-controls .control-group {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .shelf-controls .selected-shelf-info {
      margin-right: 20px;
      font-weight: bold;
      display: flex;
      align-items: center;
    }

    .shelf-edit-btn {
      background-color: #409EFF;
    }

    .shelf-edit-btn:hover {
      background-color: #66B1FF;
    }

    .shelf-delete-btn {
      background-color: #F56C6C;
    }

    .shelf-delete-btn:hover {
      background-color: #F78989;
    }

    .size-label {
      display: inline-block;
      width: 10px;
      height: 10px;
      margin-right: 5px;
      border-radius: 50%;
    }

    .size-label.small {
      background-color: #2196F3;
    }

    .size-label.medium {
      background-color: #ff9800;
    }

    .size-label.large {
      background-color: #f44336;
    }

    button {
      padding: 8px 15px;
      background-color: #4CAF50;
      border: none;
      color: white;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }

    button:hover {
      background-color: #45a049;
    }

    button:disabled {
      background-color: #cccccc;
      color: #888888;
      cursor: not-allowed;
    }

    .warehouse-size-info {
      position: absolute;
      right: 10px;
      top: 10px;
      background-color: rgba(255, 255, 255, 0.8);
      padding: 5px 8px;
      border-radius: 4px;
      font-size: 12px;
      color: #333;
      pointer-events: none;
      z-index: 5;
    }

    .warehouse-size-presets {
      display: flex;
      justify-content: center;
      margin: 10px auto;
      gap: 10px;
    }

    .size-preset {
      background-color: #f0f0f0;
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 5px 10px;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .size-preset:hover {
      background-color: #e0e0e0;
    }

    .size-preset.active {
      background-color: #2196F3;
      color: white;
      border-color: #0b7dda;
    }

    .search-container {
      display: flex;
      align-items: center;
      margin: 15px auto;
      max-width: 800px;
      background-color: #f0f0f0;
      padding: 12px 15px;
      border-radius: 4px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .search-input {
      flex: 1;
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
      outline: none;
    }

    .search-input:focus {
      border-color: #2196F3;
      box-shadow: 0 0 5px rgba(33, 150, 243, 0.3);
    }

    .search-button {
      margin-left: 10px;
      background-color: #2196F3;
      padding: 8px 15px;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }

    .search-button:hover {
      background-color: #0b7dda;
    }

    .search-clear {
      background-color: #f44336;
    }

    .search-clear:hover {
      background-color: #da190b;
    }

    .search-result-status {
      margin-left: 10px;
      font-size: 14px;
      color: #555;
    }

    .shelf.hidden {
      display: none;
    }

    /* è´§æ¶æ“ä½œé€‰é¡¹æ ·å¼ */
    .shelf-options {
      position: absolute;
      top: 100%;
      /* æ”¹ä¸º100%ï¼Œä½¿å…¶ä½äºè´§æ¶ä¸‹æ–¹ */
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      justify-content: center;
      z-index: 10;
      margin-top: 5px;
      /* æ·»åŠ ä¸Šè¾¹è· */
      white-space: nowrap;
      /* é˜²æ­¢æŒ‰é’®æ¢è¡Œ */
      background-color: rgba(255, 255, 255, 0.9);
      /* æ·»åŠ åŠé€æ˜èƒŒæ™¯ */
      padding: 5px;
      border-radius: 4px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .shelf-option-btn {
      margin: 0 5px;
      padding: 6px 12px;
      border: none;
      border-radius: 4px;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .view-inventory-btn {
      background-color: #2196F3;
      color: white;
    }

    .view-inventory-btn:hover {
      background-color: #1976D2;
    }

    .edit-sku-btn {
      background-color: #FF9800;
      color: white;
    }

    .edit-sku-btn:hover {
      background-color: #F57C00;
    }

    /* å¼¹å‡ºå±‚æ ·å¼ */
    .el-dialog__body {
      padding: 10px 20px !important;
    }

    .el-table {
      margin-bottom: 10px;
    }

    .el-table .selected-row {
      background-color: #e3f2fd;
    }

    .el-dialog__header {
      padding: 15px 20px !important;
      border-bottom: 1px solid #eee;
    }

    .el-dialog__footer {
      padding: 10px 20px 15px !important;
      border-top: 1px solid #eee;
    }

    /* è´§æ¶æ“ä½œæŒ‰é’®æ ·å¼ */
    .shelf-design-options {
      display: none;
    }
  </style>
</head>

<body>
  <div id="app">
    <h1 style="text-align: center;">ä»“åº“è´§æ¶å¸ƒå±€ç®¡ç†</h1>

    <div class="mode-switch">
      <div class="current-mode" v-if="!designMode">
        <span class="mode-status view"></span> æŸ¥çœ‹æ¨¡å¼
      </div>
      <button class="mode-button" :class="designMode ? 'design' : 'view'" @click="toggleMode">
        <span class="mode-icon">{{ designMode ? 'ğŸ’¾' : 'âœï¸' }}</span>
        {{ designMode ? 'ä¿å­˜å¸ƒå±€' : 'è®¾è®¡å¸ƒå±€' }}
      </button>
    </div>

    <!-- æœç´¢åŠŸèƒ½ï¼Œåªåœ¨æŸ¥çœ‹æ¨¡å¼æ˜¾ç¤º -->
    <div v-if="!designMode">
      <div class="search-container">
        <input type="text" class="search-input" v-model="searchQuery" placeholder="è¾“å…¥è´§æ¶IDã€åç§°æˆ–åŒºåŸŸè¿›è¡Œæœç´¢"
          @keyup.enter="searchShelves">
        <button class="search-button" @click="searchShelves">æœç´¢è´§æ¶</button>
        <button class="search-button search-clear" @click="clearSearch" v-if="isSearchActive">æ¸…é™¤æœç´¢</button>
        <div class="search-result-status" v-if="isSearchActive">
          æ‰¾åˆ° {{ filteredShelves.length }} ä¸ªåŒ¹é…è´§æ¶
        </div>
      </div>
    </div>

    <div>
      <div class="controls">
        <button @click="addShelf" :disabled="!designMode">æ·»åŠ æ–°è´§æ¶</button>
        <button @click="clearLayout" :disabled="!designMode">æ¸…ç©ºå¸ƒå±€</button>
      </div>
    </div>

    <div v-if="currentShelf !== null && designMode">
      <div class="shelf-controls">
        <div class="selected-shelf-info">
          å½“å‰é€‰ä¸­: è´§æ¶ #{{ shelves[currentShelf].id }} ({{ shelves[currentShelf].name }})
        </div>
        <div class="control-group">
          <button class="shelf-edit-btn" @click="editShelfName(currentShelf)">
            ç¼–è¾‘åç§°
          </button>
          <button class="shelf-delete-btn" @click="deleteShelf(currentShelf)">
            åˆ é™¤è´§æ¶
          </button>
        </div>
        <div class="control-group">
          <button class="small" @click="setShelfSize('small')">
            <span class="size-label small"></span> å°å°ºå¯¸
          </button>
          <button class="medium" @click="setShelfSize('medium')">
            <span class="size-label medium"></span> ä¸­å°ºå¯¸
          </button>
          <button class="large" @click="setShelfSize('large')">
            <span class="size-label large"></span> å¤§å°ºå¯¸
          </button>
        </div>
      </div>
    </div>

    <div class="warehouse-container" :class="{'design-mode': designMode}" ref="warehouseRef">
      <div class="resize-indicator" v-if="designMode">â¤¡</div>
      <div class="warehouse-size-info" v-if="designMode">
        {{ warehouseWidth }} Ã— {{ warehouseHeight }} åƒç´ 
      </div>

      <!-- æ·»åŠ è°ƒæ•´å¤§å°çš„è¾¹ç¼˜å¤„ç†ï¼Œåªåœ¨è®¾è®¡æ¨¡å¼ä¸‹æ˜¾ç¤º -->
      <div v-if="designMode" class="resize-edge right" @mousedown.stop="startResizeWarehouse('right', $event)"></div>
      <div v-if="designMode" class="resize-edge bottom" @mousedown.stop="startResizeWarehouse('bottom', $event)"></div>
      <div v-if="designMode" class="resize-edge corner" @mousedown.stop="startResizeWarehouse('corner', $event)"></div>

      <div v-for="(shelf, index) in shelves" :key="shelf.id" class="shelf" :class="{
          'view-mode': !designMode, 
          'hidden': !designMode && isSearchActive && !isShelfVisible(shelf)
        }" :style="{ 
          width: shelf.width + 'px', 
          height: shelf.height + 'px',
          left: shelf.x + 'px',
          top: shelf.y + 'px'
        }" @click.stop="designMode ? selectShelf(index) : showShelfOptions(shelf.id)">
        <!-- <div class="shelf-header">è´§æ¶ #{{ shelf.id }}</div> -->
        <div class="shelf-body" @mousedown.stop="designMode && startDrag(index, $event)">{{ shelf.name }}</div>

        <!-- è°ƒæ•´å¤§å°çš„å››ä¸ªæ‰‹æŸ„ï¼Œåªåœ¨è®¾è®¡æ¨¡å¼æ˜¾ç¤º -->
        <div v-if="designMode" class="resize-handle nw" @mousedown.stop="startResize(index, 'nw', $event)"></div>
        <div v-if="designMode" class="resize-handle ne" @mousedown.stop="startResize(index, 'ne', $event)"></div>
        <div v-if="designMode" class="resize-handle sw" @mousedown.stop="startResize(index, 'sw', $event)"></div>
        <div v-if="designMode" class="resize-handle se" @mousedown.stop="startResize(index, 'se', $event)"></div>

        <!-- æŸ¥çœ‹æ¨¡å¼ä¸‹ç‚¹å‡»è´§æ¶æ˜¾ç¤ºçš„æ“ä½œé€‰é¡¹ -->
        <div class="shelf-options" v-if="!designMode && selectedShelfId === shelf.id" @click.stop>
          <button class="shelf-option-btn view-inventory-btn" @click.stop="viewShelfInventory(shelf)">
            æŸ¥çœ‹åº“å­˜
          </button>
          <button class="shelf-option-btn edit-sku-btn" @click.stop="editShelfSku(shelf)">
            ä¿®æ”¹æ¬¾å·
          </button>
        </div>
      </div>
    </div>

    <div v-if="designMode">
      <div class="warehouse-size-presets">
        <div v-for="preset in sizePresets" :key="preset.name" class="size-preset"
          :class="{ active: warehouseWidth === preset.width && warehouseHeight === preset.height }"
          @click="applyWarehouseSize(preset.width, preset.height)">
          {{ preset.name }} ({{ preset.width }}Ã—{{ preset.height }})
        </div>
      </div>
    </div>

    <div class="info-panel" v-if="shelves.length > 0">
      <h3>è´§æ¶å¸ƒå±€ä¿¡æ¯</h3>
      <div class="shelf-info" v-for="shelf in shelves" :key="'info-'+shelf.id">
        <span>è´§æ¶ #{{ shelf.id }} ({{ shelf.name }})</span>
        <span>ä½ç½®: X={{ shelf.x }}, Y={{ shelf.y }}, å®½={{ shelf.width }}, é«˜={{ shelf.height }}</span>
      </div>
    </div>

    <el-dialog :visible.sync="showModal.showInventoryDetailsModal" title="è´§æ¶åº“å­˜è¯¦æƒ…" width="500px" :before-close="closeModal"
      :append-to-body="true" :close-on-click-modal="false" :close-on-press-escape="false" center>
      <div class="inventory-details-modal-content">
        <div class="inventory-details-modal-content-header">
          <span>{{ modalTitle.inventoryDetailsModalTitle }}</span>
        </div>
        <div class="inventory-details-modal-content-body" v-infinite-scroll="loadInventoryDetailsModalData">
          <div class="inventory-details-modal-content-body-item" v-for="(item,index) in inventoryDetailsModalData"
            :key="index">
            <span>SKU001</span>
            <span>100</span>
          </div>
        </div>
      </div>
      </el-dialog>
      <el-dialog :visible.sync="showModal.showEditSkuModal" title="ä¿®æ”¹è´§æ¶æ¬¾å·" width="500px" :before-close="closeModal"
        :append-to-body="true" :close-on-click-modal="false" :close-on-press-escape="false" center>
        <div class="product-modal-content">
          <div class="product-modal-content-header">
            <span>{{ modalTitle.editSkuModalTitle }}</span>
          </div>
          <div class="product-modal-content-body" v-infinite-scroll="loadInventoryDetailsModalData">
            <div class="product-modal-content-body-item" v-for="(item,index) in inventoryDetailsModalData" :key="index">
              <span>SKU001</span>
              <span>100</span>
            </div>
          </div>
        </div>
    </el-dialog>
  </div>

  <!-- å¼•å…¥Sortable -->
  <script src="https://cdn.bootcdn.net/ajax/libs/Sortable/1.10.2/Sortable.min.js"></script>
  <!-- å¼•å…¥Vue.Draggable -->
  <script src="https://cdn.bootcdn.net/ajax/libs/Vue.Draggable/2.24.3/vuedraggable.umd.min.js"></script>

  <script>
    // ä½¿ç”¨Element UI
    Vue.use(ELEMENT)
    ELEMENT.locale(ELEMENT.lang.zhCN) // è®¾ç½®è¯­è¨€ä¸ºä¸­æ–‡

    new Vue({
      el: '#app',
      data: {
        shelves: [
          { id: 1, name: 'AåŒº-1å·', x: 50, y: 50, width: 100, height: 80, sku: 'SKU001', inventory: [{ sku: 'A1001', quantity: 50 }, { sku: 'A1002', quantity: 30 }] },
          { id: 2, name: 'AåŒº-2å·', x: 200, y: 50, width: 120, height: 80, sku: 'SKU002', inventory: [{ sku: 'A2001', quantity: 20 }] },
          { id: 3, name: 'BåŒº-1å·', x: 50, y: 200, width: 150, height: 100, sku: 'SKU003', inventory: [] },
          { id: 4, name: 'BåŒº-2å·', x: 250, y: 200, width: 100, height: 150, sku: 'SKU004', inventory: [{ sku: 'B2001', quantity: 60 }, { sku: 'B2002', quantity: 45 }] }
        ],
        nextId: 5,
        currentShelf: null,
        isDragging: false,
        isResizing: false,
        isResizingWarehouse: false,
        resizeDirection: null,
        warehouseResizeDirection: null,
        startX: 0,
        startY: 0,
        startWidth: 0,
        startHeight: 0,
        startTop: 0,
        startLeft: 0,
        dragOffsetX: 0,
        dragOffsetY: 0,
        shelfSizes: {
          small: { width: 80, height: 60 },
          medium: { width: 120, height: 90 },
          large: { width: 180, height: 120 }
        },
        modalTitle: {
          inventoryDetailsModalTitle: 'è´§æ¶xxxåº“å­˜è¯¦æƒ…',
          editSkuModalTitle: 'ä¿®æ”¹è´§æ¶xxxæ¬¾å·'
        },
        designMode: false, // é»˜è®¤è¿›å…¥æŸ¥çœ‹æ¨¡å¼
        warehouseWidth: 800,
        warehouseHeight: 600,
        sizePresets: [
          { name: 'å°å‹ä»“åº“', width: 600, height: 400 },
          { name: 'ä¸­å‹ä»“åº“', width: 800, height: 600 },
          { name: 'å¤§å‹ä»“åº“', width: 1000, height: 700 }
        ],
        searchQuery: '',
        isSearchActive: false,
        filteredShelves: [],
        // è´§æ¶æ“ä½œç›¸å…³
        selectedShelfId: null,
        showModal: {
          showInventoryDetailsModal: false,
          showEditSkuModal: false
        },

        inventoryDetailsModalData: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10],
        currentModalShelf: null,
        selectedSkuIndex: -1,
        // å†™æ­»çš„æ¬¾å·æ•°æ®
        skuList: [
          { code: 'SKU001', status: 'æ­£å¸¸' },
          { code: 'SKU002', status: 'æ­£å¸¸' },
          { code: 'SKU003', status: 'ç¼ºè´§' },
          { code: 'SKU004', status: 'æ­£å¸¸' },
          { code: 'SKU005', status: 'åœäº§' },
          { code: 'SKU006', status: 'æ­£å¸¸' },
          { code: 'SKU007', status: 'æ–°å“' },
          { code: 'SKU008', status: 'çƒ­é”€' }
        ]
      },
      mounted() {
        console.log(document)

        // å…¨å±€ç›‘å¬é¼ æ ‡äº‹ä»¶ï¼Œç”¨äºå¤„ç†è´§æ¶è°ƒæ•´å¤§å°
        // åœ¨documentçº§åˆ«ç›‘å¬å¯ç¡®ä¿å³ä½¿é¼ æ ‡ç§»å‡ºè´§æ¶å…ƒç´ ï¼Œä¹Ÿèƒ½æŒç»­æ•è·é¼ æ ‡ç§»åŠ¨
        document.addEventListener('mousemove', this.onMouseMove)
        document.addEventListener('mouseup', this.onMouseUp)

        // åœ¨DOMæ›´æ–°ååˆå§‹åŒ–äº‹ä»¶å’Œå°ºå¯¸
        this.$nextTick(() => {
          // ç¡®ä¿åœ¨Vueæ›´æ–°DOMåç»‘å®šäº‹ä»¶
          const warehouseEl = this.$refs.warehouseRef
          if (warehouseEl) {
            // ç›‘å¬ä»“åº“å®¹å™¨çš„ç‚¹å‡»äº‹ä»¶ï¼Œç”¨äºå–æ¶ˆé€‰ä¸­è´§æ¶
            warehouseEl.addEventListener('mousedown', this.onWarehouseClick)
            // åˆå§‹åŒ–ä»“åº“å°ºå¯¸
            this.updateWarehouseSize()
          }
        })
      },
      beforeDestroy() {
        // ç»„ä»¶é”€æ¯å‰ç§»é™¤æ‰€æœ‰äº‹ä»¶ç›‘å¬å™¨ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼
        // ç§»é™¤documentä¸Šçš„å…¨å±€äº‹ä»¶ç›‘å¬
        document.removeEventListener('mousemove', this.onMouseMove)
        document.removeEventListener('mouseup', this.onMouseUp)
        document.removeEventListener('mousemove', this.onWarehouseResize)
        document.removeEventListener('mouseup', this.onWarehouseResizeEnd)

        // ç§»é™¤ä»“åº“å®¹å™¨ä¸Šçš„äº‹ä»¶ç›‘å¬
        const warehouseEl = this.$refs.warehouseRef
        if (warehouseEl) {
          warehouseEl.removeEventListener('mousedown', this.onWarehouseClick)
        }
      },
      methods: {
        loadInventoryDetailsModalData() {
          console.log('loadInventoryDetailsModalData')
        },
        addShelf() {
          const warehouseEl = this.$refs.warehouseRef
          const width = 100
          const height = 80

          this.shelves.push({
            id: this.nextId,
            name: `æ–°è´§æ¶-${this.nextId}`,
            x: Math.random() * (warehouseEl.clientWidth - width),
            y: Math.random() * (warehouseEl.clientHeight - height),
            width: width,
            height: height
          })
          this.nextId++
        },
        saveLayout() {
          // ä¿å­˜å¸ƒå±€åˆ°LocalStorage
          const warehouseEl = this.$refs.warehouseRef


          const layoutData = {
            shelves: this.shelves,
            warehouseSize: {
              width: warehouseEl.style.width.replace('px', ''),
              height: warehouseEl.style.height.replace('px', '')
            }
          }
          localStorage.setItem('warehouseLayout', JSON.stringify(layoutData))
          alert('è´§æ¶å¸ƒå±€å·²ä¿å­˜!')
        },
        toggleMode() {
          if (this.designMode) {


            // å¦‚æœå½“å‰æ˜¯è®¾è®¡æ¨¡å¼ï¼Œç‚¹å‡»æŒ‰é’®å°±æ˜¯ä¿å­˜å¸ƒå±€å¹¶åˆ‡æ¢åˆ°æŸ¥çœ‹æ¨¡å¼
            this.saveLayout()
            this.designMode = false
          } else {

            // å¦‚æœå½“å‰æ˜¯æŸ¥çœ‹æ¨¡å¼ï¼Œç‚¹å‡»æŒ‰é’®å°±æ˜¯åˆ‡æ¢åˆ°è®¾è®¡æ¨¡å¼
            this.designMode = true
          }
        },
        clearLayout() {
          if (!this.designMode) return

          if (confirm('ç¡®å®šè¦æ¸…ç©ºå½“å‰å¸ƒå±€å—?')) {
            this.shelves = []
            localStorage.removeItem('warehouseLayout')
          }
        },
        selectShelf(index) {
          if (!this.isDragging && !this.isResizing && this.designMode) {
            this.currentShelf = index
          }
        },
        startDrag(index, event) {
          if (!this.designMode) return  // éè®¾è®¡æ¨¡å¼ä¸‹ä¸å…è®¸æ‹–åŠ¨

          event.preventDefault()  // é˜»æ­¢é»˜è®¤äº‹ä»¶å¤„ç†
          this.isDragging = true  // è®¾ç½®æ‹–åŠ¨çŠ¶æ€
          this.currentShelf = index  // è®¾ç½®å½“å‰é€‰ä¸­çš„è´§æ¶ç´¢å¼•

          const shelf = this.shelves[index]

          // è®¡ç®—é¼ æ ‡ç‚¹å‡»ä½ç½®ä¸è´§æ¶å·¦ä¸Šè§’çš„åç§»é‡
          // ä¿å­˜è¿™ä¸ªåç§»é‡æ˜¯ä¸ºäº†åœ¨æ‹–åŠ¨è¿‡ç¨‹ä¸­ä¿æŒé¼ æ ‡ç›¸å¯¹äºè´§æ¶çš„ä½ç½®ä¸å˜
          this.dragOffsetX = event.clientX - shelf.x
          this.dragOffsetY = event.clientY - shelf.y

          // åœ¨documentä¸Šæ·»åŠ äº‹ä»¶ç›‘å¬ï¼Œç¡®ä¿é¼ æ ‡ç§»å‡ºå…ƒç´ åä»èƒ½æ•è·äº‹ä»¶
          // è¿™æ ·å³ä½¿ç”¨æˆ·å¿«é€Ÿç§»åŠ¨é¼ æ ‡ï¼Œæ‹–åŠ¨ä¹Ÿèƒ½æŒç»­è¿›è¡Œ
          document.addEventListener('mousemove', this.onDrag)
          document.addEventListener('mouseup', this.onDragEnd)
        },
        onDrag(event) {
          // å¦‚æœä¸åœ¨æ‹–åŠ¨çŠ¶æ€æˆ–æ²¡æœ‰é€‰ä¸­è´§æ¶ï¼Œåˆ™ç›´æ¥è¿”å›
          if (!this.isDragging || this.currentShelf === null) return

          const warehouseEl = this.$refs.warehouseRef
          const warehouseRect = warehouseEl.getBoundingClientRect()
          const shelf = this.shelves[this.currentShelf]

          // è®¡ç®—æ–°ä½ç½®ï¼Œè€ƒè™‘é¼ æ ‡åç§»é‡
          // å‡å»åˆå§‹ç‚¹å‡»çš„åç§»é‡ï¼Œç¡®ä¿æ‹–åŠ¨æ„Ÿè§‰è‡ªç„¶
          let newX = event.clientX - this.dragOffsetX
          let newY = event.clientY - this.dragOffsetY

          // é™åˆ¶åœ¨ä»“åº“å®¹å™¨å†…ï¼Œé˜²æ­¢è´§æ¶è¢«æ‹–å‡ºè¾¹ç•Œ
          newX = Math.max(0, Math.min(newX, warehouseRect.width - shelf.width))
          newY = Math.max(0, Math.min(newY, warehouseRect.height - shelf.height))

          // æ›´æ–°è´§æ¶ä½ç½®
          shelf.x = newX
          shelf.y = newY
        },
        onDragEnd() {
          // æ‹–åŠ¨ç»“æŸï¼Œé‡ç½®æ‹–åŠ¨çŠ¶æ€
          this.isDragging = false
          // ç§»é™¤documentä¸Šçš„äº‹ä»¶ç›‘å¬ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼
          // æ‹–åŠ¨ç»“æŸåä¸å†éœ€è¦ç›‘å¬è¿™äº›äº‹ä»¶
          document.removeEventListener('mousemove', this.onDrag)
          document.removeEventListener('mouseup', this.onDragEnd)
        },
        startResize(index, direction, event) {
          if (!this.designMode) return  // éè®¾è®¡æ¨¡å¼ä¸‹ä¸å…è®¸è°ƒæ•´å¤§å°

          event.preventDefault()  // é˜»æ­¢é»˜è®¤äº‹ä»¶
          event.stopPropagation() // é˜»æ­¢äº‹ä»¶å†’æ³¡ï¼Œé˜²æ­¢è§¦å‘çˆ¶å…ƒç´ äº‹ä»¶

          // è®¾ç½®è°ƒæ•´å¤§å°çŠ¶æ€
          this.isResizing = true
          this.currentShelf = index
          this.resizeDirection = direction  // è®¾ç½®è°ƒæ•´æ–¹å‘ï¼ˆnw:å·¦ä¸Š, ne:å³ä¸Š, sw:å·¦ä¸‹, se:å³ä¸‹ï¼‰

          const shelf = this.shelves[index]
          // è®°å½•åˆå§‹å®½é«˜å€¼ï¼Œç”¨äºè®¡ç®—è°ƒæ•´åçš„å°ºå¯¸
          this.startWidth = shelf.width
          this.startHeight = shelf.height
          // è®°å½•é¼ æ ‡ç‚¹å‡»ä½ç½®ï¼Œç”¨äºè®¡ç®—ç§»åŠ¨è·ç¦»
          this.startX = event.clientX
          this.startY = event.clientY
          // è®°å½•è´§æ¶å·¦ä¸Šè§’ä½ç½®ï¼Œç”¨äºè°ƒæ•´å·¦ä¸Šè§’ä½ç½®
          this.startLeft = shelf.x
          this.startTop = shelf.y

          // åœ¨documentä¸Šæ·»åŠ äº‹ä»¶ç›‘å¬ï¼Œç¡®ä¿é¼ æ ‡ç§»å‡ºå…ƒç´ åä»èƒ½æ•è·äº‹ä»¶
          document.addEventListener('mousemove', this.onMouseMove)
          document.addEventListener('mouseup', this.onMouseUp)
        },
        onMouseMove(event) {
          // å¦‚æœä¸åœ¨è°ƒæ•´å¤§å°çŠ¶æ€æˆ–æ²¡æœ‰é€‰ä¸­è´§æ¶ï¼Œåˆ™ç›´æ¥è¿”å›
          if (!this.isResizing || this.currentShelf === null) return

          // è®¡ç®—é¼ æ ‡ç›¸å¯¹äºèµ·å§‹ä½ç½®çš„ç§»åŠ¨è·ç¦»
          const dx = event.clientX - this.startX
          const dy = event.clientY - this.startY
          console.log(dx, dy)

          // è·å–å½“å‰æ­£åœ¨è°ƒæ•´çš„è´§æ¶
          const shelf = this.shelves[this.currentShelf]

          // æ ¹æ®ä¸åŒçš„è°ƒæ•´æ–¹å‘ï¼Œæ›´æ–°è´§æ¶å°ºå¯¸å’Œä½ç½®
          switch (this.resizeDirection) {
            // å³ä¸‹è§’æ‹–åŠ¨ï¼šå¢åŠ å®½åº¦å’Œé«˜åº¦ï¼Œä½ç½®ä¸å˜
            case 'se':
              shelf.width = Math.max(60, this.startWidth + dx)  // ä¿è¯æœ€å°å®½åº¦ä¸º60px
              shelf.height = Math.max(60, this.startHeight + dy)  // ä¿è¯æœ€å°é«˜åº¦ä¸º60px
              break
            // å·¦ä¸‹è§’æ‹–åŠ¨ï¼šå‡å°‘å®½åº¦ï¼Œå¢åŠ é«˜åº¦ï¼Œè°ƒæ•´xåæ ‡
            case 'sw':
              shelf.width = Math.max(60, this.startWidth - dx)  // å‘å·¦æ‹–åŠ¨å¢åŠ å®½åº¦ï¼Œå‘å³æ‹–åŠ¨å‡å°‘å®½åº¦
              shelf.x = this.startLeft + this.startWidth - shelf.width  // è°ƒæ•´xåæ ‡ä¿æŒå³è¾¹ç•Œä½ç½®ä¸å˜
              shelf.height = Math.max(60, this.startHeight + dy)  // å‘ä¸‹æ‹–åŠ¨å¢åŠ é«˜åº¦
              break
            // å³ä¸Šè§’æ‹–åŠ¨ï¼šå¢åŠ å®½åº¦ï¼Œå‡å°‘é«˜åº¦ï¼Œè°ƒæ•´yåæ ‡
            case 'ne':
              shelf.width = Math.max(60, this.startWidth + dx)  // å‘å³æ‹–åŠ¨å¢åŠ å®½åº¦
              shelf.height = Math.max(60, this.startHeight - dy)  // å‘ä¸Šæ‹–åŠ¨å¢åŠ é«˜åº¦ï¼Œå‘ä¸‹æ‹–åŠ¨å‡å°‘é«˜åº¦
              shelf.y = this.startTop + this.startHeight - shelf.height  // è°ƒæ•´yåæ ‡ä¿æŒä¸‹è¾¹ç•Œä½ç½®ä¸å˜
              break
            // å·¦ä¸Šè§’æ‹–åŠ¨ï¼šå‡å°‘å®½åº¦å’Œé«˜åº¦ï¼ŒåŒæ—¶è°ƒæ•´xå’Œyåæ ‡
            case 'nw':
              shelf.width = Math.max(60, this.startWidth - dx)  // å‘å·¦æ‹–åŠ¨å¢åŠ å®½åº¦ï¼Œå‘å³æ‹–åŠ¨å‡å°‘å®½åº¦
              shelf.x = this.startLeft + this.startWidth - shelf.width  // è°ƒæ•´xåæ ‡ä¿æŒå³è¾¹ç•Œä½ç½®ä¸å˜
              shelf.height = Math.max(60, this.startHeight - dy)  // å‘ä¸Šæ‹–åŠ¨å¢åŠ é«˜åº¦ï¼Œå‘ä¸‹æ‹–åŠ¨å‡å°‘é«˜åº¦
              shelf.y = this.startTop + this.startHeight - shelf.height  // è°ƒæ•´yåæ ‡ä¿æŒä¸‹è¾¹ç•Œä½ç½®ä¸å˜
              break
          }
        },
        onMouseUp() {
          // è°ƒæ•´å¤§å°ç»“æŸï¼Œé‡ç½®çŠ¶æ€
          this.isResizing = false
          this.resizeDirection = null
          // ç§»é™¤documentä¸Šçš„äº‹ä»¶ç›‘å¬ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼
          document.removeEventListener('mousemove', this.onMouseMove)
          document.removeEventListener('mouseup', this.onMouseUp)
        },
        onWarehouseClick(event) {
          // å¤„ç†ä»“åº“å®¹å™¨çš„ç‚¹å‡»äº‹ä»¶
          if (event.target === this.$refs.warehouseRef) {
            this.currentShelf = null
          }
        },
        setShelfSize(size) {
          if (this.currentShelf !== null && this.shelfSizes[size]) {
            const shelf = this.shelves[this.currentShelf]
            const newSize = this.shelfSizes[size]

            // ä¿æŒè´§æ¶ä¸­å¿ƒä½ç½®ä¸å˜
            const centerX = shelf.x + shelf.width / 2
            const centerY = shelf.y + shelf.height / 2

            // è®¡ç®—æ–°çš„å·¦ä¸Šè§’åæ ‡
            shelf.x = centerX - newSize.width / 2
            shelf.y = centerY - newSize.height / 2

            // è®¾ç½®æ–°å°ºå¯¸R
            shelf.width = newSize.width
            shelf.height = newSize.height
          }
        },
        updateWarehouseSize() {
          const warehouseEl = this.$refs.warehouseRef
          if (warehouseEl) {
            warehouseEl.style.width = this.warehouseWidth + 'px'
            warehouseEl.style.height = this.warehouseHeight + 'px'
          }
        },

        applyWarehouseSize(width, height) {
          const warehouseEl = this.$refs.warehouseRef
          if (warehouseEl && this.designMode) {
            warehouseEl.style.width = width + 'px'
            warehouseEl.style.height = height + 'px'
            this.warehouseWidth = width
            this.warehouseHeight = height
          }
        },
        startResizeWarehouse(direction, event) {
          console.log('startResizeWarehouse', direction, event)

          if (!this.designMode) return  // éè®¾è®¡æ¨¡å¼ä¸‹ä¸å…è®¸è°ƒæ•´ä»“åº“å¤§å°

          event.preventDefault()  // é˜»æ­¢é»˜è®¤äº‹ä»¶
          event.stopPropagation() // é˜»æ­¢äº‹ä»¶å†’æ³¡ï¼Œé˜²æ­¢è§¦å‘å®¹å™¨çš„ç‚¹å‡»äº‹ä»¶

          // è®¾ç½®ä»“åº“è°ƒæ•´çŠ¶æ€
          this.isResizingWarehouse = true
          this.warehouseResizeDirection = direction  // è®¾ç½®è°ƒæ•´æ–¹å‘ï¼ˆright, bottom, cornerï¼‰

          const warehouseEl = this.$refs.warehouseRef
          // è®°å½•ä»“åº“åˆå§‹å°ºå¯¸
          this.startWidth = warehouseEl.offsetWidth
          this.startHeight = warehouseEl.offsetHeight
          // è®°å½•é¼ æ ‡èµ·å§‹ä½ç½®
          this.startX = event.clientX
          this.startY = event.clientY

          // åœ¨documentä¸Šæ·»åŠ äº‹ä»¶ç›‘å¬ï¼Œç¡®ä¿é¼ æ ‡ç§»å‡ºå…ƒç´ åä»èƒ½æ•è·äº‹ä»¶
          document.addEventListener('mousemove', this.onWarehouseResize)
          document.addEventListener('mouseup', this.onWarehouseResizeEnd)
        },

        onWarehouseResize(event) {
          // å¦‚æœä¸åœ¨è°ƒæ•´ä»“åº“å¤§å°çŠ¶æ€æˆ–ä¸åœ¨è®¾è®¡æ¨¡å¼ï¼Œåˆ™ç›´æ¥è¿”å›
          if (!this.isResizingWarehouse || !this.designMode) return

          // è®¡ç®—é¼ æ ‡ç›¸å¯¹äºèµ·å§‹ä½ç½®çš„ç§»åŠ¨è·ç¦»
          const dx = event.clientX - this.startX
          const dy = event.clientY - this.startY
          const warehouseEl = this.$refs.warehouseRef

          let newWidth = this.startWidth
          let newHeight = this.startHeight

          // æ ¹æ®ä¸åŒçš„è°ƒæ•´æ–¹å‘æ›´æ–°å°ºå¯¸
          switch (this.warehouseResizeDirection) {
            case 'right':
              // åªè°ƒæ•´å®½åº¦ï¼Œé™åˆ¶åœ¨æœ€å°400pxå’Œæœ€å¤§1200pxä¹‹é—´
              newWidth = Math.max(400, Math.min(1200, this.startWidth + dx))
              break
            case 'bottom':
              // åªè°ƒæ•´é«˜åº¦ï¼Œé™åˆ¶åœ¨æœ€å°300pxå’Œæœ€å¤§800pxä¹‹é—´
              newHeight = Math.max(300, Math.min(800, this.startHeight + dy))
              break
            case 'corner':
              // åŒæ—¶è°ƒæ•´å®½åº¦å’Œé«˜åº¦
              newWidth = Math.max(400, Math.min(1200, this.startWidth + dx))
              newHeight = Math.max(300, Math.min(800, this.startHeight + dy))
              break
          }

          // æ›´æ–°ä»“åº“å®¹å™¨å°ºå¯¸
          warehouseEl.style.width = newWidth + 'px'
          warehouseEl.style.height = newHeight + 'px'
          this.warehouseWidth = newWidth
          this.warehouseHeight = newHeight
        },

        onWarehouseResizeEnd() {
          // ä»“åº“è°ƒæ•´å¤§å°ç»“æŸï¼Œé‡ç½®çŠ¶æ€
          this.isResizingWarehouse = false
          this.warehouseResizeDirection = null
          // ç§»é™¤documentä¸Šçš„äº‹ä»¶ç›‘å¬ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼
          document.removeEventListener('mousemove', this.onWarehouseResize)
          document.removeEventListener('mouseup', this.onWarehouseResizeEnd)
        },

        // æœç´¢åŠŸèƒ½
        searchShelves() {
          if (!this.searchQuery.trim()) {
            this.clearSearch()
            return
          }

          const query = this.searchQuery.toLowerCase()
          this.filteredShelves = this.shelves.filter(shelf => {
            const idMatch = shelf.id.toString().includes(query)
            const nameMatch = shelf.name.toLowerCase().includes(query)
            return idMatch || nameMatch
          })

          this.isSearchActive = true
        },

        clearSearch() {
          this.searchQuery = ''
          this.isSearchActive = false
          this.filteredShelves = []
        },

        isShelfVisible(shelf) {
          if (!this.isSearchActive) return true
          return this.filteredShelves.some(s => s.id === shelf.id)
        },

        // æŸ¥çœ‹æ¨¡å¼ä¸‹çš„è´§æ¶æ“ä½œåŠŸèƒ½
        showShelfOptions(shelfId) {
          if (this.designMode) return

          // å¦‚æœå·²é€‰ä¸­çš„è´§æ¶è¢«å†æ¬¡ç‚¹å‡»ï¼Œåˆ™æ¸…é™¤é€‰æ‹©
          if (this.selectedShelfId === shelfId) {
            this.selectedShelfId = null
          } else {
            // å¦åˆ™é€‰ä¸­æ–°ç‚¹å‡»çš„è´§æ¶
            this.selectedShelfId = shelfId
          }
        },

        // æŸ¥çœ‹è´§æ¶åº“å­˜
        viewShelfInventory(shelf) {

          this.currentModalShelf = { ...shelf }

          this.modalData = shelf.inventory || []
          this.showModal.showInventoryDetailsModal = true
          this.selectedShelfId = null // éšè—æ“ä½œé€‰é¡¹
        },

        // ä¿®æ”¹è´§æ¶æ¬¾å·
        editShelfSku(shelf) {

          this.currentModalShelf = { ...shelf }


          this.modalData = this.skuList

          // æ‰¾åˆ°å½“å‰è´§æ¶ä½¿ç”¨çš„æ¬¾å·åœ¨åˆ—è¡¨ä¸­çš„ç´¢å¼•
          this.selectedSkuIndex = this.skuList.findIndex(item => item.code === shelf.sku)


          this.showModal.showEditSkuModal = true
          this.selectedShelfId = null // éšè—æ“ä½œé€‰é¡¹

          // åœ¨ä¸‹ä¸€ä¸ªVueæ›´æ–°å‘¨æœŸä¸­è®¾ç½®é€‰ä¸­è¡Œ
          this.$nextTick(() => {
            if (this.selectedSkuIndex >= 0 && this.$refs.skuTable) {
              this.$refs.skuTable.setCurrentRow(this.modalData[this.selectedSkuIndex])
            }
          })
        },

        // é€‰æ‹©æ¬¾å·
        handleCurrentChange(currentRow) {
          if (currentRow) {
            this.selectedSkuIndex = this.modalData.findIndex(s => s.code === currentRow.code)
          } else {
            this.selectedSkuIndex = -1
          }
        },

        // Element UIè¡¨æ ¼è¡Œæ ·å¼
        tableRowClassName({ row, rowIndex }) {
          if (this.selectedSkuIndex === rowIndex) {
            return 'selected-row'
          }
          return ''
        },

        // ä¿å­˜ä¿®æ”¹çš„æ¬¾å·
        saveShelfSku() {
          console.log('saveShelfSku')

          // if (this.selectedSkuIndex >= 0 && this.selectedSkuIndex < this.modalData.length) {
          //   const selectedSku = this.modalData[this.selectedSkuIndex]
          //   const shelf = this.shelves.find(s => s.id === this.currentModalShelf.id)
          //   if (shelf && selectedSku) {
          //     shelf.sku = selectedSku.code
          //     this.closeModal()
          //   }
          // }
        },

        // å…³é—­å¼¹çª—
        closeModal() {
          this.showModal.showInventoryDetailsModal = false
          this.showModal.showEditSkuModal = false
          this.modalData = []
          this.currentModalShelf = null
          this.selectedSkuIndex = -1
        },

        // åˆ é™¤è´§æ¶
        deleteShelf(index) {
          if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªè´§æ¶å—ï¼Ÿ')) {
            this.shelves.splice(index, 1)
          }
        },

        // ç¼–è¾‘è´§æ¶åç§°
        editShelfName(index) {
          const shelf = this.shelves[index]
          const newName = prompt('è¯·è¾“å…¥æ–°çš„è´§æ¶åç§°ï¼š', shelf.name)
          if (newName !== null && newName.trim() !== '') {
            shelf.name = newName.trim()
          }
        }
      },
      created() {
        this.modalData = []
        this.currentModalShelf = null
        this.selectedSkuIndex = -1

        // å°è¯•ä»LocalStorageåŠ è½½ä¿å­˜çš„å¸ƒå±€
        const savedLayout = localStorage.getItem('warehouseLayout')
        if (savedLayout) {
          try {
            const layoutData = JSON.parse(savedLayout)

            if (layoutData.shelves && Array.isArray(layoutData.shelves) && layoutData.shelves.length > 0) {
              // ç¡®ä¿æ¯ä¸ªè´§æ¶éƒ½æœ‰åº“å­˜å’Œæ¬¾å·å±æ€§
              layoutData.shelves.forEach(shelf => {
                if (!shelf.inventory) shelf.inventory = []
                if (!shelf.sku) shelf.sku = `SKU${shelf.id.toString().padStart(3, '0')}`
              })

              this.shelves = layoutData.shelves
              // æ›´æ–°nextIdä¸ºæœ€å¤§ID+1
              const maxId = Math.max(...layoutData.shelves.map(s => s.id))
              this.nextId = maxId + 1
            }

            // æ¢å¤ä»“åº“å°ºå¯¸
            if (layoutData.warehouseSize) {
              this.warehouseWidth = layoutData.warehouseSize.width || 800
              this.warehouseHeight = layoutData.warehouseSize.height || 600
            }
          } catch (e) {
            console.error('åŠ è½½ä¿å­˜çš„å¸ƒå±€å¤±è´¥', e)
          }
        }
      },
      watch: {
        designMode(newValue) {
          // å½“é€€å‡ºè®¾è®¡æ¨¡å¼æ—¶ï¼Œæ¸…é™¤å½“å‰é€‰ä¸­çš„è´§æ¶
          if (!newValue) {
            this.currentShelf = null

            // ç¡®ä¿é€€å‡ºè®¾è®¡æ¨¡å¼æ—¶åœæ­¢ä»»ä½•æ­£åœ¨è¿›è¡Œçš„è°ƒæ•´å¤§å°æ“ä½œ
            this.isResizingWarehouse = false
            document.removeEventListener('mousemove', this.onWarehouseResize)
            document.removeEventListener('mouseup', this.onWarehouseResizeEnd)
          } else {
            // è¿›å…¥è®¾è®¡æ¨¡å¼æ—¶æ¸…é™¤æœç´¢å’Œé€‰ä¸­çš„è´§æ¶
            this.clearSearch()
            this.selectedShelfId = null
          }
        }
      }
    });
  </script>
</body>

</html>